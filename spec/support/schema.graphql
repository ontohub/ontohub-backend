# A git branch
type Branch implements Reference {
  # The name of the reference
  name: String!

  # The referenced commit
  target: Commit!
}

# A commit of a repository
type Commit {
  # The author of the commit
  author: GitUser!

  # The time the commit was authored at
  authoredAt: Time!

  # The time the commit was created
  committedAt: Time!

  # The committer of the commit
  committer: GitUser!

  # The changes that this commit introduced
  diff: [Diff]!

  # The entries of a directory
  directory(
    # The path to the directory to list
    path: ID!
  ): [DirectoryEntry!]!

  # A file
  file(
    # Load more than the 10 Megabytes for the web view
    loadAllData: Boolean = false

    # The path to the file
    path: ID!
  ): File

  # The sha hash of the commit
  id: ID!

  # The commit message
  message: String!

  # The parents of the commit
  parentIds: [ID!]!

  # The names of the references that point to this commit
  referenceNames: [String!]!

  # The references that point to this commit
  references: [Reference!]!
}

# Possible actions for a commit
enum CommitAction {
  create
  mkdir
  remove
  rename
  update
}

# Change of a file
type Diff {
  # True if the file was deleted
  deletedFile: Boolean!

  # The actual diff
  diff: String!

  # The number of changed lines
  lineCount: Int!

  # True if the file was added
  newFile: Boolean!

  # The file mode in the new state
  newMode: String!

  # The new path of the file
  newPath: String!

  # The file mode in the old state
  oldMode: String!

  # The old path of the file
  oldPath: String!

  # True if the file was renamed
  renamedFile: Boolean!
}

# A directory of a repository
type Directory implements DirectoryEntry {
  # The history (git log) of this entry
  log(
    # Only show commits from after this date/time
    after: Time

    # Only show commits from before this date/time
    before: Time

    # Maximum number of commits to list
    limit: Int = 20

    # Skip the first n commits
    skip: Int = 0

    # Whether or not to skip merge commits in the history
    skipMerges: Boolean = false
  ): [Commit!]!

  # The name of the entry
  name: String!

  # The path of the entry
  path: String!
}

# A directory entry (directory or file) of a repository
interface DirectoryEntry {
  # The history (git log) of this entry
  log(
    # Only show commits from after this date/time
    after: Time

    # Only show commits from before this date/time
    before: Time

    # Maximum number of commits to list
    limit: Int = 20

    # Skip the first n commits
    skip: Int = 0

    # Whether or not to skip merge commits in the history
    skipMerges: Boolean = false
  ): [Commit!]!

  # The name of the entry
  name: String!

  # The path of the entry
  path: String!
}

# A file of a repository
type File implements DirectoryEntry {
  # The content of the file
  content: String!

  # The encoding of the content
  encoding: FileEncoding!

  # The number of bytes that has been loaded of the content
  loadedSize: Int!

  # The history (git log) of this entry
  log(
    # Only show commits from after this date/time
    after: Time

    # Only show commits from before this date/time
    before: Time

    # Maximum number of commits to list
    limit: Int = 20

    # Skip the first n commits
    skip: Int = 0

    # Whether or not to skip merge commits in the history
    skipMerges: Boolean = false
  ): [Commit!]!

  # The name of the entry
  name: String!

  # The path of the entry
  path: String!

  # The size in bytes
  size: Int!
}

# A file from a repository
input FileChangeset {
  # The action to be performed on the file
  action: CommitAction!

  # The new content of the file
  content: String

  # The encoding of the content
  encoding: FileEncoding

  # The new path of the file for renaming/moving
  new_path: String

  # The path of the file inside the repository
  path: String!
}

# Possible values for file encodings
enum FileEncoding {
  base64
  plain
}

# Data of a git user
type GitUser {
  # Corresponding Ontohub account of the user
  account: User

  # Email address of the user
  email: String!

  # Name of the user
  name: String!
}

# Base mutation type
type Mutation {
  # Creates a new commit
  commit(
    # The information of the commit
    newCommit: NewCommit!

    # The repository to create the branch in
    repositoryId: ID!
  ): Commit

  # Confirms the email address of a user
  confirmEmail(
    # The confirmation token from the confirmation email
    token: String!
  ): SessionToken

  # Creates a new branch
  createBranch(
    # The name of the branch
    name: String!

    # The repository to create the branch in
    repositoryId: ID!

    # The revision the branch shall point to
    revision: ID!
  ): Branch

  # Creates a new organization
  createOrganization(
    # The parameters of the new organization
    data: NewOrganization!
  ): Organization

  # Creates a new repository
  createRepository(
    # The parameters of the new repository
    data: NewRepository!
  ): Repository

  # Creates a new tag
  createTag(
    # An optional annotation for the tag
    annotation: String

    # The name of the tag
    name: String!

    # The repository to create the tag in
    repositoryId: ID!

    # The revision the tag shall point to
    revision: ID!
  ): Tag

  # Deletes the account of the currently signed in user.
  # Returns `true` if it was successful and `null` if there was an error.
  deleteAccount(
    # Password of the current user to confirm the deletion
    password: String!
  ): Boolean

  # Creates a new branch
  deleteBranch(
    # The name of the branch
    name: String!

    # The repository to delete the branch from
    repositoryId: ID!
  ): Boolean

  # Deletes an organization.
  # Returns `true` if it was successful and `null` if there was an error.
  deleteOrganization(
    # The ID of the organization to delete
    id: ID!
  ): Boolean

  # Deletes a repository
  deleteRepository(
    # The ID of the repository to delete
    id: ID!
  ): Boolean

  # Creates a new tag
  deleteTag(
    # The name of the tag
    name: String!

    # The repository to delete the tag from
    repositoryId: ID!
  ): Boolean

  # Resends the confirmation email to a user
  resendConfirmationEmail(
    # The email address of the user
    email: String!
  ): Boolean!

  # Resends the password reset email to a user
  resendPasswordResetEmail(
    # The email address of the user
    email: String!
  ): Boolean!

  # Resends the unlock account email to a user
  resendUnlockAccountEmail(
    # The email address of the user
    email: String!
  ): Boolean!

  # Resets a user's password
  resetPassword(
    # The new password
    password: String!

    # The reset token from the password reset email
    token: String!
  ): SessionToken

  # Updates the current user account
  saveAccount(
    # Updated fields of the user
    data: UserChangeset!

    # Password of the current user to confirm the update
    password: String!
  ): User

  # Updates an organization
  saveOrganization(
    # Updated fields of the organization
    data: OrganizationChangeset!

    # ID of the organization to update
    id: ID!
  ): Organization

  # Updates a repository
  saveRepository(
    # Updated fields of the repository
    data: RepositoryChangeset!

    # ID of the repository to update
    id: ID!
  ): Repository

  # Signs in a user
  signIn(
    # The user's password
    password: String!

    # The user's name
    username: String!
  ): SessionToken

  # Signs up a user
  signUp(
    # A reCAPTCHA token
    captcha: String!

    # The new user's data
    user: NewUser!
  ): SessionToken

  # Unlocks a locked user account
  unlockAccount(
    # The unlock account token from the unlock account email
    token: String!
  ): SessionToken
}

# Data for committing
input NewCommit {
  # The name of a branch to commit to
  branch: ID!

  # The changes to commit to the repository
  files: [FileChangeset!]!

  # The last known id (sha hash) of the HEAD of the branch. This is used to check
  # whether or not the branch has changed in the meantime.
  lastKnownHeadId: ID

  # A brief description of the changes in this commit
  message: String!
}

# Contains all fields that are possible to set when creating a new
# organization
input NewOrganization {
  # A short description of the organization
  description: String

  # The name of the organization
  displayName: String

  # ID of the new organization
  id: ID!
}

# Data of a new repository
input NewRepository {
  # The content type of the repository
  contentType: RepositoryContentType!

  # The description of the repository
  description: String

  # Name of the repository
  name: ID!

  # The ID of the owner
  owner: String!

  # The visibility of the repository
  visibility: RepositoryVisibility!
}

# Data of a a new user that is about to sign up
input NewUser {
  # The name of the user
  displayName: String

  # The email address of the user
  email: String!

  # The password of the user
  password: String!

  # Name/id of the user
  username: ID!
}

# Data of an organization
type Organization implements OrganizationalUnit {
  # Description of the organization
  description: String

  # Display name of the organizational unit
  displayName: String

  # ID of the organizational unit
  id: ID!

  # List of members
  members(
    # Maximum number of members to list
    limit: Int = 20

    # Skip the first n members
    skip: Int = 0
  ): [User!]!

  # List of repositories owned by this organizational unit
  repositories(
    # Maximum number of repositories to list
    limit: Int = 20

    # Skip the first n repositories
    skip: Int = 0
  ): [Repository!]!
}

# Contains all fields of an organization that can be changed
input OrganizationChangeset {
  # A short description of the organization
  description: String

  # The name of the organization
  displayName: String
}

# Common fields of organizational units
interface OrganizationalUnit {
  # Display name of the organizational unit
  displayName: String

  # ID of the organizational unit
  id: ID!

  # List of repositories owned by this organizational unit
  repositories(
    # Maximum number of repositories to list
    limit: Int = 20

    # Skip the first n repositories
    skip: Int = 0
  ): [Repository!]!
}

# Base query type
type Query {
  # The currently signed in user
  me: User

  # The organizational unit for the given ID
  organizationalUnit(
    # ID of the organizational unit
    id: ID!
  ): OrganizationalUnit

  # The repository for the given ID
  repository(
    # ID of the repository
    id: ID!
  ): Repository

  # The version of the running backend
  version: Version!
}

# A git reference
interface Reference {
  # The name of the reference
  name: String!

  # The referenced commit
  target: Commit!
}

# Data of a repository
type Repository {
  # Details of a branch
  branch(
    # The name of the branch
    name: String!
  ): Branch

  # Branches of the repository
  branches: [String!]!

  # Find a commit by revision
  commit(
    # The revision to query for
    revision: ID!
  ): Commit

  # Type of the repository
  contentType: RepositoryContentType!

  # Default branch of the repository
  defaultBranch: String

  # Description of the repository
  description: String

  # The changes between two commits
  diff(
    # The base commit for the diff
    from: String!

    # An optional list of paths to restrict the diff to
    paths: [String!]

    # The target commit for the diff
    to: String!
  ): [Diff!]!

  # ID of the repository
  id: ID!

  # Commit history (git log) of the repository
  log(
    # Only show commits from after this date/time
    after: Time

    # Only show commits from before this date/time
    before: Time

    # Maximum number of commits to list
    limit: Int = 20

    # A path to a file or directory to see the history of
    path: String = "/"

    # The newest revision to show in the history
    revision: String!

    # Skip the first n commits
    skip: Int = 0

    # Whether or not to skip merge commits in the history
    skipMerges: Boolean = false
  ): [Commit!]!

  # Name of the repository
  name: String!

  # Owner of the repository
  owner: OrganizationalUnit!

  # Details of a tag
  tag(
    # The name of the tag
    name: String!
  ): Tag

  # Tags of the repository
  tags: [String!]!

  # Visibility of the repository
  visibility: RepositoryVisibility!
}

# Contains all fields of a repository that can be changed
input RepositoryChangeset {
  # The content type of the repository
  contentType: RepositoryContentType

  # A short description of the repository
  description: String

  # The visibility of the repository
  visibility: RepositoryVisibility
}

# Possible types of repositories
enum RepositoryContentType {
  mathematical
  model
  ontology
  specification
}

# Possible values for repository visibilities
enum RepositoryVisibility {
  private
  public
}

# Data of a signed in user
type SessionToken {
  # The session token
  jwt: String!

  # The current user
  me: User!
}

# A git tag
type Tag implements Reference {
  # An annotation of the tag
  annotation: String

  # The name of the reference
  name: String!

  # The referenced commit
  target: Commit!
}

# Represents the time
scalar Time

# Data of a user
type User implements OrganizationalUnit {
  # Display name of the organizational unit
  displayName: String

  # Email address of the user
  email: String

  # MD5 hash of the user's email address
  emailHash: String!

  # ID of the organizational unit
  id: ID!

  # List of organizations the user is a member of
  organizations(
    # Maximum number of organizations to list
    limit: Int = 20

    # Skip the first n organizations
    skip: Int = 0
  ): [Organization!]!

  # List of repositories owned by this organizational unit
  repositories(
    # Maximum number of repositories to list
    limit: Int = 20

    # Skip the first n repositories
    skip: Int = 0
  ): [Repository!]!

  # Email address of the user that still needs to be confirmed
  unconfirmedEmail: String
}

# Contains all fields of a user account that can be changed
input UserChangeset {
  # The name of the user
  displayName: String

  # The email address of the user
  email: String

  # The password of the user
  password: String
}

# Version of the running backend
type Version {
  # Short git hash of the deployed version
  commit: String!

  # Amount of commits since the last version bump
  commitsSinceTag: Int!

  # Full version as generated by `git describe --long --tags`
  full: String!

  # Last published version
  tag: String!
}
